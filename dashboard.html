<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthcare Portal - Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="background-animation">
        <div class="circle circle-1"></div>
        <div class="circle circle-2"></div>
        <div class="circle circle-3"></div>
    </div>

    <div class="dashboard-container">
        <nav class="dashboard-nav">
            <div class="nav-brand">
                <h2>ğŸ¥ Healthcare Portal</h2>
            </div>
            <div class="nav-center">
                <div class="medicine-search-container">
                    <input 
                        type="text" 
                        id="medicine-search-input" 
                        placeholder="ğŸ” Search medicine (e.g., Paracetamol, Aspirin...)"
                        onkeypress="handleMedicineSearchKeyPress(event)"
                        class="medicine-search-input"
                    />
                    <button class="btn-search-medicine" onclick="searchMedicine()" title="Search Medicine">ğŸ”</button>
                </div>
            </div>
            <div class="nav-actions">
                <button class="btn-icon" id="theme-toggle" onclick="toggleTheme()" title="Toggle Dark/Light Mode">
                    <span id="theme-icon">ğŸŒ™</span>
                </button>
                <button class="btn-icon" id="settings-btn" onclick="openSettings()" title="Settings">
                    âš™ï¸
                </button>
                <button class="btn-logout" onclick="logout()">ğŸšª Logout</button>
            </div>
        </nav>

        <div class="dashboard-content">
            <!-- Patient Dashboard -->
            <div id="patient-dashboard" style="display: none;">
                <div class="dashboard-header">
                    <h1 id="welcome-message">Welcome!</h1>
                    <p id="user-type-display">You are logged in as a Patient</p>
                    <button onclick="checkUserAccount()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #17a2b8; color: white; border: none; border-radius: 5px; cursor: pointer;">ğŸ” Check My Account</button>
                </div>

                <div class="patient-layout">
                    <!-- Left Side: Medicine Schedule -->
                    <div class="medicine-schedule-panel">
                        <div class="panel-header">
                            <h3>ğŸ’Š Medicine Schedule</h3>
                        </div>
                        <div class="panel-content">
                            <div id="medicine-schedule-list">
                                <!-- Medicines will be loaded here -->
                            </div>
                            <!-- Medicine add button removed - only doctors can prescribe medicines -->
                        </div>
                    </div>

                    <!-- Middle: AI Doctor Chatbot -->
                    <div class="chatbot-panel">
                        <div class="panel-header">
                            <div class="chat-header-left">
                                <button class="btn-chat-menu" onclick="toggleChatList()" title="Show all chats">â‹®</button>
                                <h3 id="chat-title">ğŸ¤– AI Doctor Assistant</h3>
                            </div>
                            <div class="chat-header-right">
                                <span class="ai-status">Online</span>
                                <button class="btn-new-chat" onclick="createNewChat()" title="Start new chat">+ New Chat</button>
                            </div>
                        </div>
                        <!-- Chat List Dropdown -->
                        <div id="chat-list-dropdown" class="chat-list-dropdown" style="display: none;">
                            <div class="chat-list-header">
                                <h4>Your Chats</h4>
                                <button class="btn-close-chat-list" onclick="toggleChatList()">Ã—</button>
                            </div>
                            <div id="chat-list-items" class="chat-list-items">
                                <!-- Chat list items will be loaded here -->
                            </div>
                        </div>
                        <div class="chat-container">
                            <div id="chat-messages" class="chat-messages">
                                <div class="message bot-message">
                                    <div class="message-avatar">ğŸ¤–</div>
                                    <div class="message-content">
                                        <p>Hello! I'm your AI Doctor Assistant. I'm here to help you with health concerns, diagnosis, treatment suggestions, and medication information. How can I assist you today?</p>
                                        <small class="message-time"></small>
                                    </div>
                                </div>
                            </div>
                            <div class="chat-input-container">
                                <input type="text" id="chat-input" class="chat-input" placeholder="Describe your symptoms or ask a health question..." onkeypress="handleChatKeyPress(event)">
                                <button class="btn-send" onclick="sendMessage()">ğŸ“¤</button>
                            </div>
                        </div>
                    </div>

                    <!-- Right Side: Consultation Panel -->
                    <div class="consultation-panel">
                        <div class="panel-header">
                            <h3>ğŸ‘¨â€âš•ï¸ Consult Doctor</h3>
                        </div>
                        <div class="panel-content" id="consultation-content">
                            <div class="consultation-placeholder">
                                <p>Complete AI diagnosis to consult with a real doctor</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Doctor Dashboard -->
            <div id="doctor-dashboard" style="display: none;">
                <div class="dashboard-header">
                    <h1 id="doctor-welcome-message">Welcome!</h1>
                    <p id="doctor-type-display">You are logged in as a Doctor</p>
                </div>

                <div class="doctor-layout">
                    <!-- Consultation Requests -->
                    <div class="requests-panel">
                        <div class="panel-header">
                            <h3>ğŸ“‹ Consultation Requests</h3>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn-refresh" onclick="debugConsultations()">ğŸ” Debug</button>
                                <button class="btn-refresh" onclick="loadConsultationRequests()">ğŸ”„ Refresh</button>
                            </div>
                        </div>
                        <div class="panel-content" id="requests-list">
                            <!-- Requests will be loaded here -->
                        </div>
                    </div>

                    <!-- Consultation History -->
                    <div class="history-panel">
                        <div class="panel-header">
                            <h3>ğŸ“œ Consultation History</h3>
                        </div>
                        <div class="panel-content" id="history-list">
                            <!-- History will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Medicine Modal -->
    <div id="medicine-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeMedicineModal()">&times;</span>
            <h2>ğŸ’Š Add Medicine</h2>
            <form id="add-medicine-form" onsubmit="addMedicine(event)">
                <div class="form-group">
                    <label>Medicine Name</label>
                    <input type="text" id="med-name" required placeholder="e.g., Paracetamol 500mg">
                </div>
                <div class="form-group">
                    <label>Dosage</label>
                    <input type="text" id="med-dosage" required placeholder="e.g., 1 tablet">
                </div>
                <div class="form-group">
                    <label>Frequency</label>
                    <select id="med-frequency" required>
                        <option value="">Select frequency</option>
                        <option value="Once daily">Once daily</option>
                        <option value="Twice daily">Twice daily</option>
                        <option value="Thrice daily">Thrice daily</option>
                        <option value="Every 4 hours">Every 4 hours</option>
                        <option value="Every 6 hours">Every 6 hours</option>
                        <option value="Every 8 hours">Every 8 hours</option>
                        <option value="As needed">As needed</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Start Date</label>
                    <input type="date" id="med-start-date" required>
                </div>
                <div class="form-group">
                    <label>End Date</label>
                    <input type="date" id="med-end-date" required>
                </div>
                <div class="form-group">
                    <label>Times (e.g., 8:00 AM, 2:00 PM)</label>
                    <input type="text" id="med-times" required placeholder="8:00 AM, 2:00 PM, 8:00 PM">
                    <small>Separate times with commas</small>
                </div>
                <div class="form-group">
                    <label>Prescribed By</label>
                    <input type="text" id="med-prescribed-by" required placeholder="Doctor's name">
                </div>
                <button type="submit" class="btn-primary">Add Medicine</button>
            </form>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content settings-modal-content">
            <span class="close" onclick="closeSettings()">&times;</span>
            <h2>âš™ï¸ Settings</h2>
            
            <div class="settings-tabs">
                <button class="settings-tab active" onclick="openSettingsTab('profile')">ğŸ‘¤ Profile</button>
                <button class="settings-tab" onclick="openSettingsTab('appearance')">ğŸ¨ Appearance</button>
                <button class="settings-tab" onclick="openSettingsTab('notifications')">ğŸ”” Notifications</button>
                <button class="settings-tab" onclick="openSettingsTab('privacy')">ğŸ”’ Privacy</button>
            </div>
            
            <!-- Profile Tab -->
            <div id="settings-profile" class="settings-tab-content active">
                <h3>Personal Information</h3>
                <form id="profile-form" onsubmit="saveProfile(event)">
                    <div class="form-group">
                        <label for="settings-name">ğŸ‘¤ Full Name</label>
                        <input type="text" id="settings-name" required>
                    </div>
                    <div class="form-group">
                        <label for="settings-email">ğŸ“§ Email Address</label>
                        <input type="email" id="settings-email" readonly>
                        <small>Email cannot be changed</small>
                    </div>
                    <div class="form-group">
                        <label for="settings-contact">ğŸ“± Contact Number</label>
                        <input type="tel" id="settings-contact" required>
                    </div>
                    <div id="settings-specialization-group" class="form-group" style="display: none;">
                        <label for="settings-specialization">ğŸ“ Specialization</label>
                        <input type="text" id="settings-specialization">
                    </div>
                    <div id="settings-license-group" class="form-group" style="display: none;">
                        <label for="settings-license">ğŸ†” Medical License Number</label>
                        <input type="text" id="settings-license">
                    </div>
                    <div id="settings-experience-group" class="form-group" style="display: none;">
                        <label for="settings-experience">ğŸ’¼ Years of Experience</label>
                        <input type="number" id="settings-experience" min="0" max="50">
                    </div>
                    <div class="form-group">
                        <label for="settings-bio">ğŸ“ Bio</label>
                        <textarea id="settings-bio" rows="4"></textarea>
                        <small id="settings-bio-hint"></small>
                    </div>
                    <button type="submit" class="btn-primary">ğŸ’¾ Save Changes</button>
                </form>
                <div id="profile-message" class="message" style="margin-top: 1rem;"></div>
            </div>
            
            <!-- Appearance Tab -->
            <div id="settings-appearance" class="settings-tab-content">
                <h3>Theme Settings</h3>
                <div class="settings-option">
                    <label>
                        <span>ğŸŒ“ Theme Mode</span>
                        <select id="theme-select" onchange="changeTheme(this.value)">
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                            <option value="auto">Auto (System)</option>
                        </select>
                    </label>
                    <small>Choose your preferred theme. Auto will match your system preference.</small>
                </div>
                <div class="settings-option">
                    <label>
                        <input type="checkbox" id="compact-mode" onchange="toggleCompactMode()">
                        <span>ğŸ“¦ Compact Mode</span>
                    </label>
                    <small>Reduce spacing and padding for a more compact layout.</small>
                </div>
            </div>
            
            <!-- Notifications Tab -->
            <div id="settings-notifications" class="settings-tab-content">
                <h3>Notification Preferences</h3>
                <div class="settings-option">
                    <label>
                        <input type="checkbox" id="notify-consultations" checked>
                        <span>ğŸ“ Consultation Requests</span>
                    </label>
                    <small>Get notified when someone requests a consultation.</small>
                </div>
                <div class="settings-option">
                    <label>
                        <input type="checkbox" id="notify-messages" checked>
                        <span>ğŸ’¬ Chat Messages</span>
                    </label>
                    <small>Receive notifications for new chat messages.</small>
                </div>
                <div class="settings-option">
                    <label>
                        <input type="checkbox" id="notify-appointments" checked>
                        <span>ğŸ“… Appointments</span>
                    </label>
                    <small>Get reminders for upcoming appointments.</small>
                </div>
            </div>
            
            <!-- Privacy Tab -->
            <div id="settings-privacy" class="settings-tab-content">
                <h3>Privacy Settings</h3>
                <div class="settings-option">
                    <label>
                        <input type="checkbox" id="profile-visible" checked>
                        <span>ğŸ‘ï¸ Profile Visibility</span>
                    </label>
                    <small>Allow others to see your profile information.</small>
                </div>
                <div class="settings-option">
                    <label>
                        <input type="checkbox" id="online-status" checked>
                        <span>ğŸŸ¢ Show Online Status</span>
                    </label>
                    <small>Display your online status to others.</small>
                </div>
                <div class="settings-option">
                    <h4>Account Actions</h4>
                    <button class="btn-secondary" onclick="exportData()">ğŸ“¥ Export My Data</button>
                    <button class="btn-danger" onclick="deleteAccount()" style="margin-top: 1rem;">ğŸ—‘ï¸ Delete Account</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Medicine Information Modal -->
    <div id="medicine-info-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeMedicineInfoModal()">&times;</span>
            <h2>ğŸ’Š Medicine Information</h2>
            <div id="medicine-info-content">
                <div style="text-align: center; padding: 3rem; color: #666;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ’Š</div>
                    <h3 style="color: #333; margin-bottom: 0.5rem;">Search Medicine Information</h3>
                    <p style="font-size: 0.95rem;">Enter a medicine name in the search bar above to get comprehensive information.</p>
                    <p style="font-size: 0.85rem; margin-top: 0.5rem; color: #999;">You can search by generic name (e.g., "Paracetamol") or brand name (e.g., "Tylenol")</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Consultation Request Modal -->
    <div id="consultation-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeConsultationModal()">&times;</span>
            <h2>ğŸ“ Request Consultation</h2>
            <div id="consultation-summary-display"></div>
            <div id="patient-info-display"></div>
            
            <!-- Doctor Search Box -->
            <div class="doctor-search-container" style="margin: 1.5rem 0;">
                <div class="form-group">
                    <label for="doctor-search-input" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333;">
                        ğŸ” Search Doctors
                    </label>
                    <input 
                        type="text" 
                        id="doctor-search-input" 
                        placeholder="Search by name, specialization, or experience..."
                        oninput="filterDoctors(this.value)"
                        style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s;"
                        onfocus="this.style.borderColor='#667eea'; this.style.outline='none';"
                        onblur="this.style.borderColor='#e0e0e0';"
                    />
                    <p style="margin-top: 0.5rem; font-size: 0.85rem; color: #666;">
                        ğŸ’¡ Tip: Search for any doctor to request a consultation, even if you haven't consulted them before
                    </p>
                </div>
            </div>
            
            <div id="available-doctors"></div>
        </div>
    </div>

    <!-- Video Call Screen -->
    <div id="video-call-screen" class="video-call-container" style="display: none;">
        <div class="video-call-header">
            <div class="call-header-left">
                <div class="call-timer" id="call-timer">00:00</div>
                <div class="call-participant-name" id="call-participant-name">Consultation</div>
            </div>
            <button class="btn-end-call" onclick="endVideoCall()">ğŸ“ End Call</button>
        </div>
        <div class="video-call-content">
            <div class="video-call-main">
                <!-- Video Container -->
                <div class="video-container-wrapper">
                    <div class="video-box-container">
                        <!-- Remote Video (Other Party) -->
                        <div class="video-box remote-video" id="remote-video-box">
                            <video id="remote-video" autoplay playsinline></video>
                            <div class="video-placeholder-content" id="remote-video-placeholder">
                                <div class="video-avatar">ğŸ‘¤</div>
                                <p id="remote-video-label">Waiting for participant...</p>
                            </div>
                            <div class="video-controls-overlay">
                                <div class="video-label" id="remote-video-name-label"></div>
                                <div class="video-status-indicator" id="remote-status">â—</div>
                            </div>
                        </div>
                        
                        <!-- Local Video (Self) -->
                        <div class="video-box local-video" id="local-video-box">
                            <video id="local-video" autoplay playsinline muted></video>
                            <div class="video-placeholder-content" id="local-video-placeholder">
                                <div class="video-avatar">You</div>
                                <p>Your video</p>
                            </div>
                            <div class="video-controls-overlay">
                                <div class="video-label">You</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Video Call Controls -->
                    <div class="video-call-controls">
                        <button class="control-btn" id="toggle-mic-btn" onclick="toggleMicrophone()" title="Mute/Unmute Microphone">
                            <span class="control-icon">ğŸ¤</span>
                        </button>
                        <button class="control-btn" id="toggle-camera-btn" onclick="toggleCamera()" title="Turn Camera On/Off">
                            <span class="control-icon">ğŸ“¹</span>
                        </button>
                        <button class="control-btn" id="switch-camera-btn" onclick="switchCamera()" title="Switch Camera">
                            <span class="control-icon">ğŸ”„</span>
                        </button>
                    </div>
                </div>
                
                <!-- Right Panel: Patient Info & Prescription -->
                <div class="video-call-sidebar">
                    <!-- Patient/Doctor Info -->
                    <div class="call-info-panel" id="call-info-panel">
                        <h3 id="call-info-title">Participant Information</h3>
                        <div id="call-participant-details"></div>
                    </div>
                    
                    <!-- Prescription Panel (Only visible to doctor, but synced to patient) -->
                    <div class="prescription-panel" id="prescription-panel">
                        <div class="prescription-header">
                            <h3>ğŸ“‹ Prescription</h3>
                            <button class="btn-save-prescription" id="btn-save-prescription" onclick="savePrescription()" style="display: none;">ğŸ’¾ Save</button>
                        </div>
                        <textarea 
                            id="prescription-textarea" 
                            class="prescription-textarea" 
                            placeholder="Doctor: Write prescription here... (Updates in real-time for both parties)"
                            oninput="onPrescriptionChange()"
                            readonly
                        ></textarea>
                        <div class="prescription-actions" id="prescription-actions" style="display: none;">
                            <button class="btn-clear-prescription" onclick="clearPrescription()">Clear</button>
                            <button class="btn-send-prescription" onclick="savePrescription()">Save Prescription</button>
                        </div>
                        <div id="prescription-readonly-notice" class="prescription-notice">
                            <p>ğŸ“ Prescription will appear here when the doctor writes it.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script src="script.js"></script>
    <script src="config.js"></script>
    <script src="api-client.js"></script>
    <script src="dashboard.js"></script>
</body>
</html>
