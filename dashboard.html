<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Healthcare Portal - Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="background-animation">
        <div class="circle circle-1"></div>
        <div class="circle circle-2"></div>
        <div class="circle circle-3"></div>
    </div>

    <div class="dashboard-container">
        <nav class="dashboard-nav">
            <div class="nav-brand">
                <h2>ğŸ¥ Healthcare Portal</h2>
            </div>
            <div class="nav-center">
                <div class="medicine-search-container">
                    <input 
                        type="text" 
                        id="medicine-search-input" 
                        placeholder="ğŸ” Search medicine (e.g., Paracetamol, Aspirin...)"
                        onkeypress="handleMedicineSearchKeyPress(event)"
                        class="medicine-search-input"
                    />
                    <button class="btn-search-medicine" onclick="searchMedicine()" title="Search Medicine">ğŸ”</button>
                </div>
            </div>
            <div class="nav-actions">
                <button class="btn-icon" id="theme-toggle" onclick="toggleTheme()" title="Toggle Dark/Light Mode">
                    <span id="theme-icon">ğŸŒ™</span>
                </button>
                <button class="btn-icon" id="settings-btn" onclick="openSettings()" title="Settings">
                    âš™ï¸
                </button>
                <button class="btn-logout" onclick="logout()">ğŸšª Logout</button>
            </div>
        </nav>

        <div class="dashboard-content">
            <!-- Patient Dashboard -->
            <div id="patient-dashboard" style="display: none;">
                <div class="dashboard-header">
                    <h1 id="welcome-message">Welcome!</h1>
                    <p id="user-type-display">You are logged in as a Patient</p>
                    <button onclick="checkUserAccount()" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #17a2b8; color: white; border: none; border-radius: 5px; cursor: pointer;">ğŸ” Check My Account</button>
                </div>

                <!-- Patient Dashboard Tabs -->
                <div class="dashboard-tabs">
                    <button class="dashboard-tab active" onclick="switchPatientTab('main')">ğŸ  Home</button>
                    <button class="dashboard-tab" onclick="switchPatientTab('appointments')">ğŸ“… Appointments</button>
                    <button class="dashboard-tab" onclick="switchPatientTab('records')">ğŸ“‹ Medical Records</button>
                    <button class="dashboard-tab" onclick="switchPatientTab('health')">â¤ï¸ Health Dashboard</button>
                    <button class="dashboard-tab" onclick="switchPatientTab('prescriptions')">ğŸ’Š Prescriptions</button>
                    <button class="dashboard-tab" onclick="switchPatientTab('reports')">ğŸ“„ Medical Reports</button>
                    <button class="dashboard-tab" onclick="switchPatientTab('emergency')">ğŸš¨ Emergency</button>
                </div>

                <!-- Main Tab Content (Existing) -->
                <div id="patient-tab-main" class="patient-tab-content active">

                <div class="patient-layout">
                    <!-- Left Side: Medicine Schedule -->
                    <div class="medicine-schedule-panel">
                        <div class="panel-header">
                            <h3>ğŸ’Š Medicine Schedule</h3>
                        </div>
                        <div class="panel-content">
                            <div id="medicine-schedule-list">
                                <!-- Medicines will be loaded here -->
                            </div>
                            <!-- Medicine add button removed - only doctors can prescribe medicines -->
                        </div>
                    </div>

                    <!-- Middle: AI Doctor Chatbot -->
                    <div class="chatbot-panel">
                        <div class="panel-header">
                            <div class="chat-header-left">
                                <button class="btn-chat-menu" onclick="toggleChatList()" title="Show all chats">â‹®</button>
                                <h3 id="chat-title">ğŸ¤– AI Doctor Assistant</h3>
                            </div>
                            <div class="chat-header-right">
                                <span class="ai-status">Online</span>
                                <button class="btn-new-chat" onclick="createNewChat()" title="Start new chat">+ New Chat</button>
                            </div>
                        </div>
                        <!-- Chat List Dropdown -->
                        <div id="chat-list-dropdown" class="chat-list-dropdown" style="display: none;">
                            <div class="chat-list-header">
                                <h4>Your Chats</h4>
                                <button class="btn-close-chat-list" onclick="toggleChatList()">Ã—</button>
                            </div>
                            <div id="chat-list-items" class="chat-list-items">
                                <!-- Chat list items will be loaded here -->
                            </div>
                        </div>
                        <div class="chat-container">
                            <div id="chat-messages" class="chat-messages">
                                <div class="message bot-message">
                                    <div class="message-avatar">ğŸ¤–</div>
                                    <div class="message-content">
                                        <p>Hello! I'm your AI Doctor Assistant. I'm here to help you with health concerns, diagnosis, treatment suggestions, and medication information. How can I assist you today?</p>
                                        <small class="message-time"></small>
                                    </div>
                                </div>
                            </div>
                            <div class="chat-input-container">
                                <input type="text" id="chat-input" class="chat-input" placeholder="Describe your symptoms or ask a health question..." onkeypress="handleChatKeyPress(event)">
                                <button class="btn-send" onclick="sendMessage()">ğŸ“¤</button>
                            </div>
                        </div>
                    </div>

                    <!-- Right Side: Consultation Panel -->
                    <div class="consultation-panel">
                        <div class="panel-header">
                            <h3>ğŸ‘¨â€âš•ï¸ Consult Doctor</h3>
                        </div>
                        <div class="panel-content" id="consultation-content">
                            <div class="consultation-placeholder">
                                <p>Complete AI diagnosis to consult with a real doctor</p>
                            </div>
                        </div>
                    </div>
                </div>
                </div>
                <!-- End Main Tab Content -->

                <!-- Appointments Tab -->
                <div id="patient-tab-appointments" class="patient-tab-content">
                    <div class="panel">
                        <div class="panel-header">
                            <h3>ğŸ“… My Appointments</h3>
                            <button class="btn-primary" onclick="openAppointmentModal()">â• Book Appointment</button>
                        </div>
                        <div class="panel-content" id="appointments-list">
                            <p class="empty-state">No appointments scheduled. Book an appointment to get started.</p>
                        </div>
                    </div>
                </div>

                <!-- Medical Records Tab -->
                <div id="patient-tab-records" class="patient-tab-content">
                    <div class="panel">
                        <div class="panel-header">
                            <h3>ğŸ“‹ Medical Records</h3>
                            <button class="btn-secondary" onclick="exportMedicalRecords()">ğŸ“¥ Export Records</button>
                        </div>
                        <div class="panel-content" id="medical-records-list">
                            <!-- Medical records will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Health Dashboard Tab -->
                <div id="patient-tab-health" class="patient-tab-content">
                    <div class="health-dashboard-grid">
                        <div class="panel">
                            <div class="panel-header">
                                <h3>â¤ï¸ Vital Signs</h3>
                                <button class="btn-primary" onclick="openVitalsModal()">â• Add Reading</button>
                            </div>
                            <div class="panel-content" id="vitals-display">
                                <!-- Vitals will be displayed here -->
                            </div>
                        </div>
                        <div class="panel">
                            <div class="panel-header">
                                <h3>â° Medication Reminders</h3>
                                <button class="btn-primary" onclick="openReminderModal()">â• Add Reminder</button>
                            </div>
                            <div class="panel-content" id="reminders-list">
                                <!-- Reminders will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Prescriptions Tab -->
                <div id="patient-tab-prescriptions" class="patient-tab-content">
                    <div class="panel">
                        <div class="panel-header">
                            <h3>ğŸ’Š Prescription History</h3>
                            <button class="btn-secondary" onclick="exportPrescriptions()">ğŸ“¥ Export</button>
                        </div>
                        <div class="panel-content" id="prescriptions-history-list">
                            <!-- Prescription history will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Medical Reports Tab -->
                <div id="patient-tab-reports" class="patient-tab-content">
                    <div class="panel">
                        <div class="panel-header">
                            <h3>ğŸ“„ Medical Reports & Documents</h3>
                            <button class="btn-primary" onclick="openReportUploadModal()">ğŸ“¤ Upload Report</button>
                        </div>
                        <div class="panel-content" id="reports-list">
                            <!-- Medical reports will be displayed here -->
                        </div>
                    </div>
                </div>

                <!-- Emergency Contacts Tab -->
                <div id="patient-tab-emergency" class="patient-tab-content">
                    <div class="panel">
                        <div class="panel-header">
                            <h3>ğŸš¨ Emergency Contacts</h3>
                            <button class="btn-primary" onclick="openEmergencyContactModal()">â• Add Contact</button>
                        </div>
                        <div class="panel-content" id="emergency-contacts-list">
                            <!-- Emergency contacts will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Doctor Dashboard -->
            <div id="doctor-dashboard" style="display: none;">
                <div class="dashboard-header">
                    <h1 id="doctor-welcome-message">Welcome!</h1>
                    <p id="doctor-type-display">You are logged in as a Doctor</p>
                </div>

                <!-- Doctor Dashboard Tabs -->
                <div class="dashboard-tabs">
                    <button class="dashboard-tab active" onclick="switchDoctorTab('main')">ğŸ  Home</button>
                    <button class="dashboard-tab" onclick="switchDoctorTab('calendar')">ğŸ“… Calendar</button>
                    <button class="dashboard-tab" onclick="switchDoctorTab('patients')">ğŸ‘¥ My Patients</button>
                    <button class="dashboard-tab" onclick="switchDoctorTab('reviews')">â­ Reviews</button>
                    <button class="dashboard-tab" onclick="switchDoctorTab('analytics')">ğŸ“Š Analytics</button>
                </div>

                <!-- Main Tab Content (Existing) -->
                <div id="doctor-tab-main" class="doctor-tab-content active">

                <div class="doctor-layout">
                    <!-- Consultation Requests -->
                    <div class="requests-panel">
                        <div class="panel-header">
                            <h3>ğŸ“‹ Consultation Requests</h3>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn-refresh" onclick="debugConsultations()">ğŸ” Debug</button>
                                <button class="btn-refresh" onclick="loadConsultationRequests()">ğŸ”„ Refresh</button>
                            </div>
                        </div>
                        <div class="panel-content" id="requests-list">
                            <!-- Requests will be loaded here -->
                        </div>
                    </div>

                    <!-- Consultation History -->
                    <div class="history-panel">
                        <div class="panel-header">
                            <h3>ğŸ“œ Consultation History</h3>
                        </div>
                        <div class="panel-content" id="history-list">
                            <!-- History will be loaded here -->
                        </div>
                    </div>
                </div>
                </div>
                <!-- End Doctor Main Tab Content -->

                <!-- Calendar Tab -->
                <div id="doctor-tab-calendar" class="doctor-tab-content">
                    <div class="panel">
                        <div class="panel-header">
                            <h3>ğŸ“… Appointment Calendar</h3>
                            <button class="btn-primary" onclick="loadAppointmentCalendar()">ğŸ”„ Refresh</button>
                        </div>
                        <div class="panel-content" id="appointment-calendar-view">
                            <!-- Calendar will be displayed here -->
                        </div>
                    </div>
                </div>

                <!-- My Patients Tab -->
                <div id="doctor-tab-patients" class="doctor-tab-content">
                    <div class="panel">
                        <div class="panel-header">
                            <h3>ğŸ‘¥ My Patients</h3>
                            <input type="text" id="patient-search-input" placeholder="ğŸ” Search patients..." oninput="searchPatients(this.value)" style="padding: 0.5rem; border: 2px solid #e0e0e0; border-radius: 8px; width: 300px;">
                        </div>
                        <div class="panel-content" id="patients-list">
                            <!-- Patients list will be displayed here -->
                        </div>
                    </div>
                </div>

                <!-- Reviews Tab -->
                <div id="doctor-tab-reviews" class="doctor-tab-content">
                    <div class="panel">
                        <div class="panel-header">
                            <h3>â­ Patient Reviews & Ratings</h3>
                        </div>
                        <div class="panel-content" id="reviews-list">
                            <!-- Reviews will be displayed here -->
                        </div>
                    </div>
                </div>

                <!-- Analytics Tab -->
                <div id="doctor-tab-analytics" class="doctor-tab-content">
                    <div class="analytics-grid">
                        <div class="panel">
                            <div class="panel-header">
                                <h3>ğŸ“Š Consultation Statistics</h3>
                            </div>
                            <div class="panel-content" id="consultation-stats">
                                <!-- Statistics will be displayed here -->
                            </div>
                        </div>
                        <div class="panel">
                            <div class="panel-header">
                                <h3>ğŸ“ˆ Performance Overview</h3>
                            </div>
                            <div class="panel-content" id="performance-overview">
                                <!-- Performance data will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Medicine Modal -->
    <div id="medicine-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeMedicineModal()">&times;</span>
            <h2>ğŸ’Š Add Medicine</h2>
            <form id="add-medicine-form" onsubmit="addMedicine(event)">
                <div class="form-group">
                    <label>Medicine Name</label>
                    <input type="text" id="med-name" required placeholder="e.g., Paracetamol 500mg">
                </div>
                <div class="form-group">
                    <label>Dosage</label>
                    <input type="text" id="med-dosage" required placeholder="e.g., 1 tablet">
                </div>
                <div class="form-group">
                    <label>Frequency</label>
                    <select id="med-frequency" required>
                        <option value="">Select frequency</option>
                        <option value="Once daily">Once daily</option>
                        <option value="Twice daily">Twice daily</option>
                        <option value="Thrice daily">Thrice daily</option>
                        <option value="Every 4 hours">Every 4 hours</option>
                        <option value="Every 6 hours">Every 6 hours</option>
                        <option value="Every 8 hours">Every 8 hours</option>
                        <option value="As needed">As needed</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Start Date</label>
                    <input type="date" id="med-start-date" required>
                </div>
                <div class="form-group">
                    <label>End Date</label>
                    <input type="date" id="med-end-date" required>
                </div>
                <div class="form-group">
                    <label>Times (e.g., 8:00 AM, 2:00 PM)</label>
                    <input type="text" id="med-times" required placeholder="8:00 AM, 2:00 PM, 8:00 PM">
                    <small>Separate times with commas</small>
                </div>
                <div class="form-group">
                    <label>Prescribed By</label>
                    <input type="text" id="med-prescribed-by" required placeholder="Doctor's name">
                </div>
                <button type="submit" class="btn-primary">Add Medicine</button>
            </form>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content settings-modal-content">
            <span class="close" onclick="closeSettings()">&times;</span>
            <h2>âš™ï¸ Settings</h2>
            
            <div class="settings-tabs">
                <button class="settings-tab active" onclick="openSettingsTab('profile')">ğŸ‘¤ Profile</button>
                <button class="settings-tab" onclick="openSettingsTab('appearance')">ğŸ¨ Appearance</button>
                <button class="settings-tab" onclick="openSettingsTab('notifications')">ğŸ”” Notifications</button>
                <button class="settings-tab" onclick="openSettingsTab('privacy')">ğŸ”’ Privacy</button>
            </div>
            
            <!-- Profile Tab -->
            <div id="settings-profile" class="settings-tab-content active">
                <h3>Personal Information</h3>
                <form id="profile-form" onsubmit="saveProfile(event)">
                    <div class="form-group">
                        <label for="settings-name">ğŸ‘¤ Full Name</label>
                        <input type="text" id="settings-name" required>
                    </div>
                    <div class="form-group">
                        <label for="settings-email">ğŸ“§ Email Address</label>
                        <input type="email" id="settings-email" readonly>
                        <small>Email cannot be changed</small>
                    </div>
                    <div class="form-group">
                        <label for="settings-contact">ğŸ“± Contact Number</label>
                        <input type="tel" id="settings-contact" required>
                    </div>
                    <div id="settings-specialization-group" class="form-group" style="display: none;">
                        <label for="settings-specialization">ğŸ“ Specialization</label>
                        <input type="text" id="settings-specialization">
                    </div>
                    <div id="settings-license-group" class="form-group" style="display: none;">
                        <label for="settings-license">ğŸ†” Medical License Number</label>
                        <input type="text" id="settings-license">
                    </div>
                    <div id="settings-experience-group" class="form-group" style="display: none;">
                        <label for="settings-experience">ğŸ’¼ Years of Experience</label>
                        <input type="number" id="settings-experience" min="0" max="50">
                    </div>
                    <div class="form-group">
                        <label for="settings-bio">ğŸ“ Bio</label>
                        <textarea id="settings-bio" rows="4"></textarea>
                        <small id="settings-bio-hint"></small>
                    </div>
                    <button type="submit" class="btn-primary">ğŸ’¾ Save Changes</button>
                </form>
                <div id="profile-message" class="message" style="margin-top: 1rem;"></div>
            </div>
            
            <!-- Appearance Tab -->
            <div id="settings-appearance" class="settings-tab-content">
                <h3>Theme Settings</h3>
                <div class="settings-option">
                    <label>
                        <span>ğŸŒ“ Theme Mode</span>
                        <select id="theme-select" onchange="changeTheme(this.value)">
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                            <option value="auto">Auto (System)</option>
                        </select>
                    </label>
                    <small>Choose your preferred theme. Auto will match your system preference.</small>
                </div>
                <div class="settings-option">
                    <label>
                        <input type="checkbox" id="compact-mode" onchange="toggleCompactMode()">
                        <span>ğŸ“¦ Compact Mode</span>
                    </label>
                    <small>Reduce spacing and padding for a more compact layout.</small>
                </div>
            </div>
            
            <!-- Notifications Tab -->
            <div id="settings-notifications" class="settings-tab-content">
                <h3>Notification Preferences</h3>
                <div class="settings-option">
                    <label>
                        <input type="checkbox" id="notify-consultations" checked onchange="localStorage.setItem('notifyConsultations', this.checked); console.log('âœ… Consultation notifications:', this.checked ? 'enabled' : 'disabled');">
                        <span>ğŸ“ Consultation Requests</span>
                    </label>
                    <small>Get notified when someone requests a consultation.</small>
                </div>
                <div class="settings-option">
                    <label>
                        <input type="checkbox" id="notify-messages" checked onchange="localStorage.setItem('notifyMessages', this.checked); console.log('âœ… Message notifications:', this.checked ? 'enabled' : 'disabled');">
                        <span>ğŸ’¬ Chat Messages</span>
                    </label>
                    <small>Receive notifications for new chat messages.</small>
                </div>
                <div class="settings-option">
                    <label>
                        <input type="checkbox" id="notify-appointments" checked onchange="localStorage.setItem('notifyAppointments', this.checked); console.log('âœ… Appointment notifications:', this.checked ? 'enabled' : 'disabled');">
                        <span>ğŸ“… Appointments</span>
                    </label>
                    <small>Get reminders for upcoming appointments.</small>
                </div>
            </div>
            
            <!-- Privacy Tab -->
            <div id="settings-privacy" class="settings-tab-content">
                <h3>Privacy Settings</h3>
                <div class="settings-option">
                    <label>
                        <input type="checkbox" id="profile-visible" checked onchange="localStorage.setItem('profileVisible', this.checked); console.log('âœ… Profile visibility:', this.checked ? 'visible' : 'hidden');">
                        <span>ğŸ‘ï¸ Profile Visibility</span>
                    </label>
                    <small>Allow others to see your profile information.</small>
                </div>
                <div class="settings-option">
                    <label>
                        <input type="checkbox" id="online-status" checked onchange="localStorage.setItem('onlineStatus', this.checked); console.log('âœ… Online status:', this.checked ? 'visible' : 'hidden');">
                        <span>ğŸŸ¢ Show Online Status</span>
                    </label>
                    <small>Display your online status to others.</small>
                </div>
                <div class="settings-option">
                    <h4>Account Actions</h4>
                    <button class="btn-secondary" onclick="exportData()">ğŸ“¥ Export My Data</button>
                    <button class="btn-danger" onclick="deleteAccount()" style="margin-top: 1rem;">ğŸ—‘ï¸ Delete Account</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Appointment Booking Modal -->
    <div id="appointment-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAppointmentModal()">&times;</span>
            <h2>ğŸ“… Book Appointment</h2>
            <form id="appointment-form" onsubmit="bookAppointment(event)">
                <div class="form-group">
                    <label for="appointment-doctor">ğŸ‘¨â€âš•ï¸ Select Doctor</label>
                    <select id="appointment-doctor" required>
                        <option value="">Choose a doctor...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="appointment-date">ğŸ“… Date</label>
                    <input type="date" id="appointment-date" required>
                </div>
                <div class="form-group">
                    <label for="appointment-time">â° Time</label>
                    <input type="time" id="appointment-time" required>
                </div>
                <div class="form-group">
                    <label for="appointment-reason">ğŸ’¬ Reason for Visit</label>
                    <textarea id="appointment-reason" rows="4" placeholder="Brief description of the reason for appointment..."></textarea>
                </div>
                <button type="submit" class="btn-primary">ğŸ“… Book Appointment</button>
            </form>
        </div>
    </div>

    <!-- Vitals Modal -->
    <div id="vitals-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeVitalsModal()">&times;</span>
            <h2>â¤ï¸ Add Vital Signs</h2>
            <form id="vitals-form" onsubmit="saveVitals(event)">
                <div class="form-group">
                    <label for="vitals-date">ğŸ“… Date</label>
                    <input type="date" id="vitals-date" required>
                </div>
                <div class="form-group">
                    <label for="vitals-blood-pressure">ğŸ©º Blood Pressure</label>
                    <input type="text" id="vitals-blood-pressure" placeholder="e.g., 120/80">
                </div>
                <div class="form-group">
                    <label for="vitals-heart-rate">â¤ï¸ Heart Rate (BPM)</label>
                    <input type="number" id="vitals-heart-rate" placeholder="e.g., 72">
                </div>
                <div class="form-group">
                    <label for="vitals-temperature">ğŸŒ¡ï¸ Temperature (Â°F)</label>
                    <input type="number" step="0.1" id="vitals-temperature" placeholder="e.g., 98.6">
                </div>
                <div class="form-group">
                    <label for="vitals-weight">âš–ï¸ Weight (lbs)</label>
                    <input type="number" step="0.1" id="vitals-weight" placeholder="e.g., 150">
                </div>
                <div class="form-group">
                    <label for="vitals-notes">ğŸ“ Notes</label>
                    <textarea id="vitals-notes" rows="3" placeholder="Any additional notes..."></textarea>
                </div>
                <button type="submit" class="btn-primary">ğŸ’¾ Save Vitals</button>
            </form>
        </div>
    </div>

    <!-- Medication Reminder Modal -->
    <div id="reminder-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeReminderModal()">&times;</span>
            <h2>â° Add Medication Reminder</h2>
            <form id="reminder-form" onsubmit="saveReminder(event)">
                <div class="form-group">
                    <label for="reminder-medication">ğŸ’Š Medication Name</label>
                    <input type="text" id="reminder-medication" required placeholder="e.g., Paracetamol 500mg">
                </div>
                <div class="form-group">
                    <label for="reminder-time">â° Time</label>
                    <input type="time" id="reminder-time" required>
                </div>
                <div class="form-group">
                    <label for="reminder-days">ğŸ“… Days</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                        <label><input type="checkbox" name="reminder-day" value="monday"> Mon</label>
                        <label><input type="checkbox" name="reminder-day" value="tuesday"> Tue</label>
                        <label><input type="checkbox" name="reminder-day" value="wednesday"> Wed</label>
                        <label><input type="checkbox" name="reminder-day" value="thursday"> Thu</label>
                        <label><input type="checkbox" name="reminder-day" value="friday"> Fri</label>
                        <label><input type="checkbox" name="reminder-day" value="saturday"> Sat</label>
                        <label><input type="checkbox" name="reminder-day" value="sunday"> Sun</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="reminder-dosage">ğŸ’‰ Dosage</label>
                    <input type="text" id="reminder-dosage" placeholder="e.g., 1 tablet">
                </div>
                <button type="submit" class="btn-primary">ğŸ’¾ Save Reminder</button>
            </form>
        </div>
    </div>

    <!-- Medical Report Upload Modal -->
    <div id="report-upload-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeReportUploadModal()">&times;</span>
            <h2>ğŸ“„ Upload Medical Report</h2>
            <form id="report-upload-form" onsubmit="uploadReport(event)">
                <div class="form-group">
                    <label for="report-title">ğŸ“‹ Report Title</label>
                    <input type="text" id="report-title" required placeholder="e.g., Blood Test Results, X-Ray Report">
                </div>
                <div class="form-group">
                    <label for="report-date">ğŸ“… Date</label>
                    <input type="date" id="report-date" required>
                </div>
                <div class="form-group">
                    <label for="report-type">ğŸ¥ Report Type</label>
                    <select id="report-type" required>
                        <option value="">Select type...</option>
                        <option value="Lab Test">Lab Test</option>
                        <option value="X-Ray">X-Ray</option>
                        <option value="MRI">MRI</option>
                        <option value="CT Scan">CT Scan</option>
                        <option value="Ultrasound">Ultrasound</option>
                        <option value="Prescription">Prescription</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="report-file">ğŸ“ Upload File (Image/PDF)</label>
                    <input type="file" id="report-file" accept="image/*,.pdf" required>
                    <small>Supported formats: JPG, PNG, PDF</small>
                </div>
                <div class="form-group">
                    <label for="report-notes">ğŸ“ Notes</label>
                    <textarea id="report-notes" rows="3" placeholder="Any additional information about this report..."></textarea>
                </div>
                <button type="submit" class="btn-primary">ğŸ“¤ Upload Report</button>
            </form>
        </div>
    </div>

    <!-- Review/Rating Modal -->
    <div id="review-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeReviewModal()">&times;</span>
            <h2>â­ Rate Your Consultation</h2>
            <form id="review-form" onsubmit="submitReviewForm(event)">
                <input type="hidden" id="review-consultation-id">
                <input type="hidden" id="review-doctor-email">
                <div class="form-group">
                    <label>â­ Rating</label>
                    <div id="star-rating-container" style="display: flex; gap: 0.5rem; font-size: 2rem; margin: 1rem 0;">
                        <span class="star-rating" data-rating="1" onclick="setRating(1)" style="cursor: pointer; opacity: 0.3;">â­</span>
                        <span class="star-rating" data-rating="2" onclick="setRating(2)" style="cursor: pointer; opacity: 0.3;">â­</span>
                        <span class="star-rating" data-rating="3" onclick="setRating(3)" style="cursor: pointer; opacity: 0.3;">â­</span>
                        <span class="star-rating" data-rating="4" onclick="setRating(4)" style="cursor: pointer; opacity: 0.3;">â­</span>
                        <span class="star-rating" data-rating="5" onclick="setRating(5)" style="cursor: pointer; opacity: 0.3;">â­</span>
                    </div>
                    <input type="hidden" id="review-rating" required>
                </div>
                <div class="form-group">
                    <label for="review-comment">ğŸ’¬ Your Feedback (Optional)</label>
                    <textarea id="review-comment" rows="4" placeholder="Share your experience..."></textarea>
                </div>
                <button type="submit" class="btn-primary">ğŸ’¾ Submit Review</button>
                <button type="button" class="btn-secondary" onclick="skipReview()" style="margin-top: 0.5rem;">Skip</button>
            </form>
        </div>
    </div>

    <!-- Emergency Contact Modal -->
    <div id="emergency-contact-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEmergencyContactModal()">&times;</span>
            <h2>ğŸš¨ Add Emergency Contact</h2>
            <form id="emergency-contact-form" onsubmit="saveEmergencyContact(event)">
                <div class="form-group">
                    <label for="emergency-name">ğŸ‘¤ Name</label>
                    <input type="text" id="emergency-name" required placeholder="Contact's full name">
                </div>
                <div class="form-group">
                    <label for="emergency-relationship">ğŸ‘¥ Relationship</label>
                    <select id="emergency-relationship" required>
                        <option value="">Select relationship...</option>
                        <option value="Family Member">Family Member</option>
                        <option value="Friend">Friend</option>
                        <option value="Spouse">Spouse</option>
                        <option value="Parent">Parent</option>
                        <option value="Sibling">Sibling</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="emergency-phone">ğŸ“± Phone Number</label>
                    <input type="tel" id="emergency-phone" required placeholder="+1 234 567 8900">
                </div>
                <div class="form-group">
                    <label for="emergency-email">ğŸ“§ Email (Optional)</label>
                    <input type="email" id="emergency-email" placeholder="contact@example.com">
                </div>
                <div class="form-group">
                    <label for="emergency-priority">âš¡ Priority</label>
                    <select id="emergency-priority" required>
                        <option value="high">ğŸ”´ High (Primary)</option>
                        <option value="medium">ğŸŸ¡ Medium</option>
                        <option value="low">ğŸŸ¢ Low</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary">ğŸ’¾ Save Contact</button>
            </form>
        </div>
    </div>

    <!-- Medicine Information Modal -->
    <div id="medicine-info-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeMedicineInfoModal()">&times;</span>
            <h2>ğŸ’Š Medicine Information</h2>
            <div id="medicine-info-content">
                <div style="text-align: center; padding: 3rem; color: #666;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ’Š</div>
                    <h3 style="color: #333; margin-bottom: 0.5rem;">Search Medicine Information</h3>
                    <p style="font-size: 0.95rem;">Enter a medicine name in the search bar above to get comprehensive information.</p>
                    <p style="font-size: 0.85rem; margin-top: 0.5rem; color: #999;">You can search by generic name (e.g., "Paracetamol") or brand name (e.g., "Tylenol")</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Consultation Request Modal -->
    <div id="consultation-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeConsultationModal()">&times;</span>
            <h2>ğŸ“ Request Consultation</h2>
            <div id="consultation-summary-display"></div>
            <div id="patient-info-display"></div>
            
            <!-- Doctor Search Box -->
            <div class="doctor-search-container" style="margin: 1.5rem 0;">
                <div class="form-group">
                    <div style="display: flex; gap: 0.5rem; align-items: center; margin-bottom: 0.5rem;">
                        <label for="doctor-search-input" style="flex: 1; font-weight: 600; color: #333;">
                            ğŸ” Search Doctors
                        </label>
                        <button class="btn-secondary" onclick="showAllDoctors()" style="padding: 0.5rem 1rem; font-size: 0.9rem; white-space: nowrap;">
                            ğŸ“‹ Show All Doctors
                        </button>
                    </div>
                    <input 
                        type="text" 
                        id="doctor-search-input" 
                        placeholder="Search by name, specialization, experience, or bio..."
                        oninput="filterDoctors(this.value)"
                        style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s;"
                        onfocus="this.style.borderColor='#667eea'; this.style.outline='none';"
                        onblur="this.style.borderColor='#e0e0e0';"
                    />
                    <p style="margin-top: 0.5rem; font-size: 0.85rem; color: #666;">
                        ğŸ’¡ Tip: Search for any registered doctor (online or offline) to request a consultation. Use "Show All Doctors" to see everyone.
                    </p>
                </div>
            </div>
            
            <div id="available-doctors"></div>
        </div>
    </div>

    <!-- Video Call Screen -->
    <div id="video-call-screen" class="video-call-container" style="display: none;">
        <div class="video-call-header">
            <div class="call-header-left">
                <div class="call-timer" id="call-timer">00:00</div>
                <div class="call-participant-name" id="call-participant-name">Consultation</div>
            </div>
            <div class="call-header-right">
                <button class="btn-settings-call" onclick="openVideoCallSettings()" title="Video Call Settings">âš™ï¸ Settings</button>
                <button class="btn-end-call" onclick="endVideoCall()">ğŸ“ End Call</button>
            </div>
        </div>
        <div class="video-call-content">
            <!-- Left Side: Videos Stacked -->
            <div class="video-call-left">
                <!-- Top Left: Remote Video (Other Party) -->
                <div class="video-box remote-video" id="remote-video-box">
                    <video id="remote-video" autoplay playsinline volume="1.0"></video>
                    <div class="video-placeholder-content" id="remote-video-placeholder">
                        <div class="video-avatar">ğŸ‘¤</div>
                        <p id="remote-video-label">Waiting for participant...</p>
                    </div>
                    <div class="video-controls-overlay">
                        <div class="video-label" id="remote-video-name-label"></div>
                        <div class="video-status-indicator" id="remote-status">â—</div>
                    </div>
                </div>
                
                <!-- Bottom Left: Local Video (Self) -->
                <div class="video-box local-video" id="local-video-box">
                    <video id="local-video" autoplay playsinline muted></video>
                    <div class="video-placeholder-content" id="local-video-placeholder">
                        <div class="video-avatar">You</div>
                        <p>Your video</p>
                    </div>
                    <div class="video-controls-overlay">
                        <div class="video-label">You</div>
                    </div>
                </div>
                
                <!-- Video Call Controls -->
                <div class="video-call-controls">
                    <button class="control-btn" id="toggle-mic-btn" onclick="toggleMicrophone()" title="Mute/Unmute Microphone">
                        <span class="control-icon">ğŸ¤</span>
                    </button>
                    <button class="control-btn" id="toggle-camera-btn" onclick="toggleCamera()" title="Turn Camera On/Off">
                        <span class="control-icon">ğŸ“¹</span>
                    </button>
                    <button class="control-btn" id="switch-camera-btn" onclick="switchCamera()" title="Switch Camera">
                        <span class="control-icon">ğŸ”„</span>
                    </button>
                    <button class="control-btn" id="toggle-screen-btn" onclick="toggleScreenShare()" title="Share Screen">
                        <span class="control-icon">ğŸ–¥ï¸</span>
                    </button>
                    <button class="control-btn control-btn-end" onclick="endVideoCall()" title="End Call">
                        <span class="control-icon">ğŸ“</span>
                    </button>
                </div>
            </div>
            
            <!-- Right Side: Sidebar with Info & Prescription -->
            <div class="video-call-sidebar">
                <!-- Patient/Doctor Info -->
                <div class="call-info-panel" id="call-info-panel">
                    <h3 id="call-info-title">Participant Information</h3>
                    <div id="call-participant-details"></div>
                </div>
                
                <!-- Prescription Panel (Only visible to doctor, but synced to patient) -->
                <div class="prescription-panel" id="prescription-panel">
                    <div class="prescription-header">
                        <h3>ğŸ“‹ Prescription</h3>
                        <div class="prescription-header-actions" id="prescription-header-actions" style="display: none;">
                            <button class="btn-clear-prescription" onclick="clearPrescription()" title="Clear prescription">ğŸ—‘ï¸ Clear</button>
                            <button class="btn-save-prescription" id="btn-save-prescription" onclick="savePrescription()" title="Save prescription">ğŸ’¾ Save</button>
                        </div>
                    </div>
                    <div class="prescription-content">
                        <textarea 
                            id="prescription-textarea" 
                            class="prescription-textarea" 
                            placeholder="Doctor: Write prescription here... (Updates in real-time for both parties)"
                            oninput="onPrescriptionChange()"
                            readonly
                        ></textarea>
                        <div id="prescription-readonly-notice" class="prescription-notice">
                            <p>ğŸ“ Prescription will appear here when the doctor writes it.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Video Call Settings Modal -->
    <div id="video-call-settings-modal" class="modal">
        <div class="modal-content settings-modal-content" style="max-width: 600px;">
            <span class="close" onclick="closeVideoCallSettings()">&times;</span>
            <h2>âš™ï¸ Video Call Settings</h2>
            
            <div class="settings-tabs">
                <button class="settings-tab active" onclick="openVideoSettingsTab('video')">ğŸ“¹ Video</button>
                <button class="settings-tab" onclick="openVideoSettingsTab('audio')">ğŸ¤ Audio</button>
                <button class="settings-tab" onclick="openVideoSettingsTab('network')">ğŸŒ Network</button>
                <button class="settings-tab" onclick="openVideoSettingsTab('advanced')">ğŸ”§ Advanced</button>
            </div>
            
            <!-- Video Settings Tab -->
            <div id="video-settings-tab" class="settings-tab-content active">
                <h3>Video Settings</h3>
                <div class="form-group">
                    <label for="video-resolution">ğŸ“ Video Resolution</label>
                    <select id="video-resolution" onchange="updateVideoSettings()">
                        <option value="low">Low (320x240)</option>
                        <option value="medium" selected>Medium (640x480)</option>
                        <option value="high">High (1280x720)</option>
                        <option value="ultra">Ultra HD (1920x1080)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="video-framerate">ğŸ¬ Frame Rate (FPS)</label>
                    <select id="video-framerate" onchange="updateVideoSettings()">
                        <option value="15">15 FPS</option>
                        <option value="24">24 FPS</option>
                        <option value="30" selected>30 FPS</option>
                        <option value="60">60 FPS</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="video-camera">ğŸ“· Camera Device</label>
                    <select id="video-camera" onchange="updateVideoSettings()">
                        <option value="default">Default Camera</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="video-mirror" onchange="updateVideoSettings()">
                        <span>ğŸª Mirror Video (Flip horizontally)</span>
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="video-autofocus" checked onchange="updateVideoSettings()">
                        <span>ğŸ” Auto Focus</span>
                    </label>
                </div>
            </div>
            
            <!-- Audio Settings Tab -->
            <div id="audio-settings-tab" class="settings-tab-content">
                <h3>Audio Settings</h3>
                <div class="form-group">
                    <label for="audio-input">ğŸ¤ Microphone</label>
                    <select id="audio-input" onchange="updateVideoSettings()">
                        <option value="default">Default Microphone</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="audio-output">ğŸ”Š Speaker</label>
                    <select id="audio-output" onchange="updateVideoSettings()">
                        <option value="default">Default Speaker</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="audio-echo-cancellation">
                        ğŸ”Š Echo Cancellation
                        <input type="checkbox" id="audio-echo-cancellation" checked onchange="updateVideoSettings()">
                    </label>
                </div>
                <div class="form-group">
                    <label for="audio-noise-suppression">
                        ğŸ”‡ Noise Suppression
                        <input type="checkbox" id="audio-noise-suppression" checked onchange="updateVideoSettings()">
                    </label>
                </div>
                <div class="form-group">
                    <label for="audio-auto-gain">
                        ğŸ“Š Auto Gain Control
                        <input type="checkbox" id="audio-auto-gain" checked onchange="updateVideoSettings()">
                    </label>
                </div>
                <div class="form-group">
                    <label for="audio-volume">ğŸ”Š Volume: <span id="audio-volume-value">50</span>%</label>
                    <input type="range" id="audio-volume" min="0" max="100" value="50" oninput="updateAudioVolume(this.value)" onchange="updateVideoSettings()">
                </div>
            </div>
            
            <!-- Network Settings Tab -->
            <div id="network-settings-tab" class="settings-tab-content">
                <h3>Network Settings</h3>
                <div class="form-group">
                    <label for="network-bandwidth">ğŸ“¡ Bandwidth Limit</label>
                    <select id="network-bandwidth" onchange="updateVideoSettings()">
                        <option value="unlimited">Unlimited</option>
                        <option value="high">High (2 Mbps)</option>
                        <option value="medium" selected>Medium (1 Mbps)</option>
                        <option value="low">Low (500 Kbps)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="network-quality">ğŸ“Š Quality Preference</label>
                    <select id="network-quality" onchange="updateVideoSettings()">
                        <option value="balanced" selected>Balanced</option>
                        <option value="quality">Prioritize Quality</option>
                        <option value="speed">Prioritize Speed</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="network-adaptive" checked onchange="updateVideoSettings()">
                        <span>ğŸ”„ Adaptive Bitrate (Auto-adjust quality)</span>
                    </label>
                </div>
                <div id="network-stats" style="margin-top: 1rem; padding: 1rem; background: rgba(0,0,0,0.1); border-radius: 8px;">
                    <h4>Network Statistics</h4>
                    <p><strong>Connection:</strong> <span id="network-connection-status">Checking...</span></p>
                    <p><strong>Latency:</strong> <span id="network-latency">-</span> ms</p>
                    <p><strong>Packet Loss:</strong> <span id="network-packet-loss">-</span>%</p>
                    <p><strong>Bitrate:</strong> <span id="network-bitrate">-</span> Kbps</p>
                </div>
            </div>
            
            <!-- Advanced Settings Tab -->
            <div id="advanced-settings-tab" class="settings-tab-content">
                <h3>Advanced Settings</h3>
                <div class="form-group">
                    <label for="advanced-codec">ğŸ¥ Video Codec</label>
                    <select id="advanced-codec" onchange="updateVideoSettings()">
                        <option value="vp8">VP8</option>
                        <option value="vp9">VP9</option>
                        <option value="h264" selected>H.264</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="advanced-dtx" onchange="updateVideoSettings()">
                        <span>ğŸ”‡ Discontinuous Transmission (DTX)</span>
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="advanced-agc" checked onchange="updateVideoSettings()">
                        <span>ğŸ“Š Automatic Gain Control</span>
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="advanced-aec" checked onchange="updateVideoSettings()">
                        <span>ğŸ”Š Acoustic Echo Cancellation</span>
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="advanced-ns" checked onchange="updateVideoSettings()">
                        <span>ğŸ”‡ Noise Suppression</span>
                    </label>
                </div>
                <div class="form-group">
                    <button class="btn-secondary" onclick="testVideoSettings()" style="margin-top: 1rem;">ğŸ§ª Test Settings</button>
                    <button class="btn-secondary" onclick="resetVideoSettings()" style="margin-top: 1rem; margin-left: 0.5rem;">ğŸ”„ Reset to Defaults</button>
                </div>
            </div>
            
            <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #e0e0e0;">
                <button class="btn-primary" onclick="applyVideoCallSettings()">ğŸ’¾ Apply Settings</button>
                <button class="btn-secondary" onclick="closeVideoCallSettings()" style="margin-left: 0.5rem;">Cancel</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script src="script.js"></script>
    <script src="config.js"></script>
    <script src="api-client.js"></script>
    <script src="dashboard.js"></script>
</body>
</html>
